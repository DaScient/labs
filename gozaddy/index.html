<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>ðŸ”® GoZaddy.ai | News Summaries ðŸ“°</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="AI-Generated News Summaries from worldwide sources with model cycling, real-time updates, and executive-ready formatting." />
<style>
  :root{
    --bg:#fff; --text:#0b1220; --muted:#667085; --border:#e5e7eb; --accent:#0f6fff; --chip:#f3f4f6;
  }
  *{box-sizing:border-box}
  body{margin:0;background:transparent;color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;line-height:1.55}
  header{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.95);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid var(--border)}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  h1{margin:0;font-size:28px;font-weight:800;letter-spacing:.2px}
  .meta{display:flex;gap:10px;align-items:center;flex-wrap:wrap;color:var(--muted);font-size:13px;margin-top:6px}
  .pill{display:inline-flex;align-items:center;gap:6px;font-size:12px;border:1px solid var(--border);background:#fff;border-radius:999px;padding:6px 10px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  select{border:1px solid var(--border);border-radius:10px;padding:8px 10px;background:#fff;color:#0b1220}
  main{padding:18px 0 60px}
  .card{border:1px solid var(--border);border-radius:14px;padding:16px;background:#fff;margin:10px 0}
  .title{font-size:22px;font-weight:800;margin:0 0 6px}
  .sub{display:flex;gap:12px;align-items:center;flex-wrap:wrap;font-size:13px;color:var(--muted)}
  .badge{display:inline-block;background:var(--chip);border:1px solid var(--border);border-radius:999px;padding:3px 8px;font-size:12px}
  .summary{margin-top:12px;font-size:17px}
  .kw{margin-top:10px;font-size:13px;color:#334155}
  a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .copy{cursor:pointer;border:1px solid var(--border);background:#fff;border-radius:10px;padding:6px 10px;font-size:12px}
  .good{color:#15803d} .warn{color:#b45309} .bad{color:#b91c1c}
  .fade{animation:fade .6s ease 1}@keyframes fade{from{opacity:.4}to{opacity:1}}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>ðŸ”® GoZaddy.ai | News Summaries ðŸ“°</h1>
    <div class="meta">
      <span id="status">Loadingâ€¦</span>
      <span class="pill">Model cycling: <strong>auto</strong></span>
      <span class="pill">Refresh: <strong>~5 min</strong></span>
    </div>
    <div class="controls">
      <label>Style
        <select id="styleSel">
          <option value="strategic">Strategic (default)</option>
          <option value="neutral">Neutral</option>
          <option value="bullet">Bulleted</option>
          <option value="editorial">Editorial</option>
        </select>
      </label>
      <label>Length
        <select id="lengthSel">
          <option value="short">Short</option>
          <option value="medium">Medium</option>
          <option value="long">Long</option>
        </select>
      </label>
      <label>Model
        <select id="modelSel">
          <option value="auto">Auto (cycle)</option>
          <option value="gpt-4o-mini">gpt-4o-mini</option>
          <option value="gpt-4.1-mini">gpt-4.1-mini</option>
          <option value="gpt-4o">gpt-4o</option>
          <option value="gpt-4.1">gpt-4.1</option>
        </select>
      </label>
    </div>
  </div>
</header>

<main class="wrap">
  <div id="list"></div>
</main>

<script>
/* ===== Config (override via URL query if you want) ===== */
const WORKER_BASE = "https://gozaddy.aristocles24.workers.dev";
const DEFAULT_FEEDS = [
  "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
  "https://feeds.bbci.co.uk/news/rss.xml",
  "https://www.aljazeera.com/xml/rss/all.xml",
  "https://www.npr.org/rss/rss.php?id=1001",
  "https://www.reuters.com/rss/worldNews"
].join(",");
const FRONTEND_POLL_MS = 300_000; // ~5 mins
/* ======================================================= */

const $ = (s)=>document.querySelector(s);
const listEl = $("#list");
const styleSel = $("#styleSel");
const lengthSel = $("#lengthSel");
const modelSel = $("#modelSel");

const q = new URLSearchParams(location.search);
if (q.get("style")) styleSel.value = q.get("style");
if (q.get("length")) lengthSel.value = q.get("length");
if (q.get("model")) modelSel.value = q.get("model");

styleSel.addEventListener("change", reload);
lengthSel.addEventListener("change", reload);
modelSel.addEventListener("change", reload);

let lastHash = "";

async function reload() {
  $("#status").textContent = "Updatingâ€¦";
  try {
    const url = new URL(WORKER_BASE + "/summaries");
    url.searchParams.set("feeds", q.get("feeds") || DEFAULT_FEEDS);
    url.searchParams.set("limit", q.get("limit") || "18");
    url.searchParams.set("interval", q.get("interval") || "3600");
    url.searchParams.set("style", styleSel.value);
    url.searchParams.set("length", lengthSel.value);
    url.searchParams.set("model", modelSel.value);

    const r = await fetch(url.toString(), { cache: "no-store" });
    if (!r.ok) throw new Error("Fetch failed " + r.status);
    const data = await r.json();

    const h = await sha(JSON.stringify(data.items.map(x => x.id)));
    if (h !== lastHash) {
      renderList(data.items);
      lastHash = h;
    }
    $("#status").textContent = "Last updated " + new Date().toLocaleString();
  } catch (e) {
    console.error(e);
    $("#status").textContent = "Update failed";
  } finally {
    setTimeout(reload, FRONTEND_POLL_MS);
  }
}

function renderList(items) {
  listEl.innerHTML = "";
  for (const a of items) {
    const card = document.createElement("article");
    card.className = "card fade";

    const title = document.createElement("h2");
    title.className = "title";
    title.textContent = stripCdata(a.title);

    const sub = document.createElement("div");
    sub.className = "sub";
    if (a.host) sub.appendChild(badge(a.host));
    if (a.published) sub.appendChild(document.createTextNode(" " + a.published));
    if (a.link) {
      const link = document.createElement("a");
      link.href = a.link;
      link.target = "_blank";
      link.rel = "noopener";
      link.textContent = "Open source";
      sub.appendChild(document.createTextNode(" "));
      sub.appendChild(link);
    }
    const conf = document.createElement("span");
    conf.className = "badge";
    conf.innerHTML = `Confidence: <strong class="${grade(a.confidence)}">${a.confidence}</strong>`;
    sub.appendChild(conf);

    const model = document.createElement("span");
    model.className = "badge";
    model.textContent = `Model: ${a.model}${a.cached ? " (cached)" : ""}`;
    sub.appendChild(model);

    const rt = document.createElement("span");
    rt.className = "badge";
    rt.textContent = `~${readTime(a.summary)} sec read`;
    sub.appendChild(rt);

    const body = document.createElement("div");
    body.className = "summary";
    body.textContent = a.summary;

    const kw = (a.keywords || []).slice(0, 8);
    if (kw.length) {
      const k = document.createElement("div");
      k.className = "kw";
      k.textContent = "SEO: " + kw.join(", ");
      body.appendChild(document.createElement("br"));
      body.appendChild(k);
    }

    const row = document.createElement("div");
    row.className = "row";
    const copyBtn = document.createElement("button");
    copyBtn.className = "copy";
    copyBtn.textContent = "Copy summary";
    copyBtn.onclick = async () => {
      await navigator.clipboard.writeText(`${a.title}\n${a.summary}\n${a.link||""}`);
      copyBtn.textContent = "Copied";
      setTimeout(()=>copyBtn.textContent="Copy summary", 1200);
    };
    row.appendChild(copyBtn);

    card.appendChild(title);
    card.appendChild(sub);
    card.appendChild(body);
    card.appendChild(row);
    listEl.appendChild(card);
  }
}

function badge(t) {
  const b = document.createElement("span");
  b.className = "badge";
  b.textContent = t;
  return b;
}

function grade(n){ return n>=70?"good":n>=45?"warn":"bad"; }
function readTime(t){ const w=(t||"").split(/\s+/).length; return Math.max(10, Math.round(w/3)); }
function stripCdata(s){ return (s||"").replace(/<!\[CDATA\[(.*?)\]\]>/gis, "$1"); }

async function sha(str){
  const d=new TextEncoder().encode(str);
  const b=await crypto.subtle.digest("SHA-256", d);
  return Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,"0")).join("");
}

// boot
reload();
</script>
</body>
</html>
